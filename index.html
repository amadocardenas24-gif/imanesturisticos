<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AR Experience Pro - Un Marcador</title>
    
    <!-- A-Frame y MindAR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
        /* ================= RESET TOTAL ================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            font-family: 'Arial', sans-serif;
            background: #000;
        }

        /* ================= PANTALLA DE CARGA SUPER GR√ÅFICA ================= */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                #1a1a2e 0%, 
                #16213e 25%, 
                #0f3460 50%, 
                #533483 75%, 
                #e94560 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Animaci√≥n de fondo */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Part√≠culas flotantes */
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        /* Logo animado */
        .logo-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 30px;
            z-index: 10;
        }

        .logo {
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite, rotate 20s linear infinite;
            box-shadow: 
                0 0 60px rgba(0, 219, 222, 0.5),
                0 0 120px rgba(252, 0, 255, 0.3),
                inset 0 0 30px rgba(255, 255, 255, 0.2);
        }

        .logo-inner {
            width: 80%;
            height: 80%;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            color: white;
            text-shadow: 0 0 20px #00dbde;
            animation: innerPulse 3s infinite alternate;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes innerPulse {
            from { box-shadow: inset 0 0 30px rgba(0, 219, 222, 0.5); }
            to { box-shadow: inset 0 0 60px rgba(252, 0, 255, 0.7); }
        }

        /* T√≠tulo animado */
        .loading-title {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 10px;
            text-align: center;
            z-index: 10;
            text-shadow: 
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(0, 219, 222, 0.6),
                0 0 30px rgba(252, 0, 255, 0.4);
            animation: textGlow 2s infinite alternate;
        }

        @keyframes textGlow {
            from { text-shadow: 0 0 10px rgba(255, 255, 255, 0.8); }
            to { text-shadow: 0 0 20px rgba(0, 219, 222, 0.8), 0 0 30px rgba(252, 0, 255, 0.6); }
        }

        /* Subt√≠tulo */
        .loading-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
            margin-bottom: 30px;
            text-align: center;
            z-index: 10;
            animation: fadeInOut 3s infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* Barra de progreso futurista */
        .progress-container {
            width: 80%;
            max-width: 400px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 10;
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.5),
                0 0 20px rgba(0, 219, 222, 0.3);
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, 
                #00dbde 0%, 
                #fc00ff 50%, 
                #00dbde 100%);
            background-size: 200% 100%;
            animation: progressGradient 2s linear infinite;
            border-radius: 8px;
            position: relative;
            transition: width 0.5s cubic-bezier(0.65, 0, 0.35, 1);
            box-shadow: 0 0 20px rgba(0, 219, 222, 0.5);
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.3) 50%, 
                transparent 100%);
            animation: shine 1.5s infinite;
        }

        @keyframes progressGradient {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Porcentaje */
        .percentage {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            margin: 15px 0;
            z-index: 10;
            text-shadow: 0 0 10px rgba(0, 219, 222, 0.8);
            animation: countUp 0.5s ease-out;
        }

        /* Contador de stats */
        .stats-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            z-index: 10;
        }

        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: statPulse 4s infinite;
        }

        .stat:nth-child(2) { animation-delay: 1s; }
        .stat:nth-child(3) { animation-delay: 2s; }

        @keyframes statPulse {
            0%, 100% { transform: translateY(0); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
            50% { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,219,222,0.4); }
        }

        .stat-value {
            font-size: 1.5rem;
            color: #00dbde;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Bot√≥n de inicio */
        #start-btn {
            padding: 18px 50px;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: none;
            z-index: 10;
            box-shadow: 
                0 10px 30px rgba(0, 219, 222, 0.4),
                0 0 50px rgba(252, 0, 255, 0.3);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        #start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            animation: btnShine 3s infinite;
        }

        @keyframes btnShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        #start-btn:hover {
            transform: scale(1.05);
            box-shadow: 
                0 15px 40px rgba(0, 219, 222, 0.6),
                0 0 60px rgba(252, 0, 255, 0.5);
        }

        /* ================= ESCENA AR ================= */
        #ar-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s;
        }

        /* ================= CONTROLES AR ================= */
        #ar-controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
            z-index: 1000;
        }

        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0, 219, 222, 0.4);
            transition: all 0.3s;
        }

        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(252, 0, 255, 0.5);
        }

        /* Indicador de detecci√≥n */
        #detection-indicator {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            display: none;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 2px solid #00dbde;
            box-shadow: 0 0 20px rgba(0, 219, 222, 0.5);
            animation: indicatorPulse 2s infinite;
        }

        @keyframes indicatorPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 219, 222, 0.5); }
            50% { box-shadow: 0 0 30px rgba(252, 0, 255, 0.7); }
        }

        /* ================= OCULTAR UI DE A-FRAME ================= */
        .a-enter-vr, .a-enter-ar, .vr-button, .ar-button,
        .a-orientation-modal, .a-dialog, .a-modal,
        .mindar-ui-overlay, .a-loader-title {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        /* ================= RESPONSIVE ================= */
        @media (max-width: 768px) {
            .loading-title { font-size: 2rem; }
            .logo-container { width: 150px; height: 150px; }
            .logo-inner { font-size: 35px; }
            .control-btn { width: 60px; height: 60px; font-size: 20px; }
            .stats-container { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <!-- ================= PANTALLA DE CARGA ANIMADA ================= -->
    <div id="loading-screen">
        <div class="particles" id="particles"></div>
        
        <div class="logo-container">
            <div class="logo">
                <div class="logo-inner">AR</div>
            </div>
        </div>
        
        <div class="loading-title">EXPERIENCIA DE REALIDAD AUMENTADA</div>
        <div class="loading-subtitle">Preparando la magia digital...</div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="percentage" id="percentage">0%</div>
        
        <div class="stats-container">
            <div class="stat">
                <div class="stat-value" id="stat-assets">0</div>
                <div class="stat-label">Assets</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-ar">0%</div>
                <div class="stat-label">AR Ready</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-power">100%</div>
                <div class="stat-label">Power</div>
            </div>
        </div>
        
        <button id="start-btn">INICIAR EXPERIENCIA AR</button>
    </div>

    <!-- ================= ESCENA AR ================= -->
    <div id="ar-scene"></div>

    <!-- ================= CONTROLES AR ================= -->
    <div id="ar-controls">
        <button class="control-btn" id="sound-btn" title="Sonido">üîá</button>
        <button class="control-btn" id="info-btn" title="Informaci√≥n">‚ÑπÔ∏è</button>
        <button class="control-btn" id="fullscreen-btn" title="Pantalla completa">‚õ∂</button>
    </div>

    <!-- ================= INDICADOR DE DETECCI√ìN ================= -->
    <div id="detection-indicator">
        <span id="detection-text">Buscando marcador...</span>
    </div>

    <script>
        // ================= VARIABLES GLOBALES =================
        let arScene = null;
        let arVideo = null;
        let arTarget = null;
        let soundEnabled = false;
        let progressInterval;

        // ================= CREAR PART√çCULAS =================
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Tama√±o aleatorio
                const size = Math.random() * 10 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Posici√≥n aleatoria
                particle.style.left = `${Math.random() * 100}%`;
                
                // Color aleatorio
                const colors = [
                    'rgba(0, 219, 222, 0.6)',
                    'rgba(252, 0, 255, 0.6)',
                    'rgba(255, 255, 255, 0.6)',
                    'rgba(233, 69, 96, 0.6)'
                ];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                // Animaci√≥n
                particle.style.animationDuration = `${Math.random() * 20 + 10}s`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // ================= ANIMAR ESTAD√çSTICAS =================
        function animateStats() {
            const assetsStat = document.getElementById('stat-assets');
            const arStat = document.getElementById('stat-ar');
            const powerStat = document.getElementById('stat-power');
            
            let assetsValue = 0;
            let arValue = 0;
            let powerValue = 100;
            
            const assetsInterval = setInterval(() => {
                assetsValue += Math.floor(Math.random() * 3) + 1;
                if (assetsValue > 100) {
                    assetsValue = 100;
                    clearInterval(assetsInterval);
                }
                assetsStat.textContent = assetsValue;
            }, 50);
            
            const arInterval = setInterval(() => {
                arValue += Math.floor(Math.random() * 5) + 1;
                if (arValue > 100) {
                    arValue = 100;
                    clearInterval(arInterval);
                }
                arStat.textContent = `${arValue}%`;
            }, 60);
            
            // Animar potencia (efecto visual)
            setInterval(() => {
                powerValue = 90 + Math.floor(Math.random() * 20);
                powerStat.textContent = `${powerValue}%`;
            }, 500);
        }

        // ================= SIMULAR CARGA =================
        function simulateLoading() {
            const progressBar = document.getElementById('progress-bar');
            const percentage = document.getElementById('percentage');
            const startBtn = document.getElementById('start-btn');
            
            let progress = 0;
            
            clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                // Incremento no lineal para mayor realismo
                let increment;
                if (progress < 70) {
                    increment = Math.random() * 3 + 2;
                } else if (progress < 90) {
                    increment = Math.random() * 2 + 1;
                } else {
                    increment = Math.random() * 0.5 + 0.2;
                }
                
                progress += increment;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                percentage.textContent = Math.round(progress) + '%';
                
                // Efecto de porcentaje
                percentage.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    percentage.style.transform = 'scale(1)';
                }, 150);
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    
                    // Mostrar bot√≥n con animaci√≥n
                    setTimeout(() => {
                        startBtn.style.display = 'block';
                        startBtn.style.animation = 'fadeIn 0.5s forwards';
                        
                        // Efecto final
                        percentage.style.color = '#00ff88';
                        percentage.textContent = '¬°LISTO!';
                        
                        // Actualizar stats finales
                        document.getElementById('stat-ar').textContent = '100%';
                        document.getElementById('stat-assets').textContent = '100';
                    }, 500);
                }
            }, 100);
        }

        // ================= INICIAR EXPERIENCIA AR =================
        function startARExperience() {
            const loadingScreen = document.getElementById('loading-screen');
            const arSceneContainer = document.getElementById('ar-scene');
            const arControls = document.getElementById('ar-controls');
            const detectionIndicator = document.getElementById('detection-indicator');
            
            // Desvanecer pantalla de carga
            loadingScreen.style.opacity = '0';
            
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                
                // Crear escena AR
                arSceneContainer.innerHTML = `
                    <a-scene 
                        mindar-image="imageTargetSrc: ./marker.mind; autoStart: true; uiScanning: no; uiLoading: no; uiError: no;" 
                        vr-mode-ui="enabled: false"
                        device-orientation-permission-ui="enabled: false"
                        permission-ui="enabled: false"
                        renderer="colorManagement: true; alpha: true; antialias: true;"
                        embedded
                        loading-screen="enabled: false"
                        keyboard-shortcuts="enterVR: false"
                    >
                        <a-assets>
                            <video 
                                id="main-video" 
                                src="./asset.mp4" 
                                preload="auto"
                                loop 
                                muted 
                                playsinline 
                                webkit-playsinline
                                crossorigin="anonymous"
                            ></video>
                        </a-assets>
                        
                        <a-camera 
                            position="0 0 0" 
                            look-controls="enabled: false"
                            wasd-controls="enabled: false"
                        ></a-camera>
                        
                        <a-entity 
                            id="main-target" 
                            mindar-image-target="targetIndex: 0"
                        >
                            <a-video
                                src="#main-video"
                                width="1.78"
                                height="1"
                                position="0 0 0"
                                rotation="0 0 0"
                                material="shader: flat; transparent: true; alphaTest: 0.5;"
                            ></a-video>
                        </a-entity>
                    </a-scene>
                `;
                
                // Mostrar escena AR
                setTimeout(() => {
                    arSceneContainer.style.opacity = '1';
                    
                    // Mostrar controles
                    arControls.style.display = 'flex';
                    detectionIndicator.style.display = 'block';
                    
                    // Configurar eventos AR
                    setTimeout(() => {
                        setupAREvents();
                    }, 1000);
                    
                }, 100);
                
            }, 500);
        }

        // ================= CONFIGURAR EVENTOS AR =================
        function setupAREvents() {
            arTarget = document.querySelector('#main-target');
            arVideo = document.querySelector('#main-video');
            const soundBtn = document.getElementById('sound-btn');
            const infoBtn = document.getElementById('info-btn');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const detectionIndicator = document.getElementById('detection-indicator');
            const detectionText = document.getElementById('detection-text');
            
            if (arTarget && arVideo) {
                console.log('‚úÖ AR Configurado correctamente');
                
                // Evento: Marcador detectado
                arTarget.addEventListener('targetFound', () => {
                    console.log('üéØ Marcador detectado');
                    
                    // Actualizar indicador
                    detectionText.textContent = '‚úÖ Marcador detectado - Video reproduci√©ndose';
                    detectionIndicator.style.borderColor = '#00ff88';
                    detectionIndicator.style.boxShadow = '0 0 30px rgba(0, 255, 136, 0.7)';
                    
                    // Reproducir video
                    arVideo.muted = !soundEnabled;
                    arVideo.play().then(() => {
                        console.log('‚ñ∂Ô∏è Video en reproducci√≥n');
                    }).catch(err => {
                        console.log('‚ö†Ô∏è Error reproduciendo video:', err);
                        // Intentar con mute
                        arVideo.muted = true;
                        arVideo.play();
                    });
                });
                
                // Evento: Marcador perdido
                arTarget.addEventListener('targetLost', () => {
                    console.log('‚ùå Marcador perdido');
                    
                    // Actualizar indicador
                    detectionText.textContent = 'üîç Buscando marcador...';
                    detectionIndicator.style.borderColor = '#00dbde';
                    detectionIndicator.style.boxShadow = '0 0 20px rgba(0, 219, 222, 0.5)';
                    
                    // Pausar video
                    arVideo.pause();
                });
                
                // Bot√≥n de sonido
                soundBtn.addEventListener('click', () => {
                    soundEnabled = !soundEnabled;
                    
                    if (arVideo) {
                        arVideo.muted = !soundEnabled;
                    }
                    
                    soundBtn.innerHTML = soundEnabled ? 'üîä' : 'üîá';
                    
                    // Efecto visual
                    soundBtn.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        soundBtn.style.transform = 'scale(1)';
                    }, 100);
                    
                    console.log(soundEnabled ? 'üîä Sonido activado' : 'üîá Sonido desactivado');
                });
                
                // Bot√≥n de informaci√≥n
                infoBtn.addEventListener('click', () => {
                    detectionText.textContent = 'üì± Apunta la c√°mara al marcador para ver el contenido AR';
                    setTimeout(() => {
                        if (detectionText.textContent.includes('marcador para ver')) {
                            detectionText.textContent = 'üîç Buscando marcador...';
                        }
                    }, 3000);
                });
                
                // Bot√≥n de pantalla completa
                fullscreenBtn.addEventListener('click', () => {
                    const elem = document.documentElement;
                    
                    if (!document.fullscreenElement) {
                        if (elem.requestFullscreen) {
                            elem.requestFullscreen();
                        } else if (elem.webkitRequestFullscreen) {
                            elem.webkitRequestFullscreen();
                        } else if (elem.msRequestFullscreen) {
                            elem.msRequestFullscreen();
                        }
                    } else {
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        } else if (document.msExitFullscreen) {
                            document.msExitFullscreen();
                        }
                    }
                });
                
                // Limpiar UI de A-Frame peri√≥dicamente
                setInterval(() => {
                    const uiElements = document.querySelectorAll('.a-enter-vr, .a-enter-ar');
                    uiElements.forEach(el => {
                        el.style.display = 'none';
                        el.style.opacity = '0';
                    });
                }, 500);
                
            } else {
                console.log('üîÑ Reintentando configuraci√≥n AR...');
                setTimeout(setupAREvents, 500);
            }
        }

        // ================= INICIALIZACI√ìN =================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Iniciando Experiencia AR Premium');
            
            // Crear part√≠culas
            createParticles();
            
            // Animar estad√≠sticas
            animateStats();
            
            // Iniciar carga
            simulateLoading();
            
            // Configurar bot√≥n de inicio
            document.getElementById('start-btn').addEventListener('click', startARExperience);
            
            // Ajustar altura para m√≥viles
            document.body.style.height = window.innerHeight + 'px';
        });

        // ================= MANEJAR REDIMENSIONAMIENTO =================
        window.addEventListener('resize', () => {
            document.body.style.height = window.innerHeight + 'px';
        });

        // ================= MANEJAR PANTALLA COMPLETA =================
        document.addEventListener('fullscreenchange', handleFullscreen);
        document.addEventListener('webkitfullscreenchange', handleFullscreen);
        document.addEventListener('msfullscreenchange', handleFullscreen);

        function handleFullscreen() {
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            if (document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.msFullscreenElement) {
                fullscreenBtn.innerHTML = '‚õ∂';
                fullscreenBtn.title = 'Salir de pantalla completa';
            } else {
                fullscreenBtn.innerHTML = '‚õ∂';
                fullscreenBtn.title = 'Pantalla completa';
            }
        }
    </script>
</body>
</html>
