<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Experiencia AR - Pantalla Completa</title>
    
    <!-- A-Frame y MindAR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
        /* ================= RESET TOTAL ================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* ================= CUERPO PRINCIPAL ================= */
        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            font-family: Arial, sans-serif;
        }

        /* ================= PANTALLA DE CARGA ================= */
        #pantalla-carga {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }

        #logo-carga {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 30px;
            animation: latido 2s infinite;
            border: 5px solid white;
        }

        @keyframes latido {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .texto-carga {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        #contenedor-progreso {
            width: 80%;
            max-width: 300px;
            height: 12px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        #barra-progreso {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 0.3s;
        }

        #porcentaje {
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
        }

        /* ================= BOTÃ“N DE INICIAR ================= */
        #btn-iniciar {
            padding: 15px 40px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        #btn-iniciar:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        /* ================= ESCENA AR (OCULTA INICIALMENTE) ================= */
        #contenedor-ar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s;
        }

        /* ================= BOTÃ“N DE SONIDO ================= */
        #btn-sonido {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #25d366;
            border: 3px solid white;
            color: white;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* ================= OCULTAR TODA LA UI DE A-FRAME ================= */
        .a-enter-vr, 
        .a-enter-ar,
        .vr-button,
        .ar-button,
        .a-orientation-modal,
        .a-dialog,
        .a-modal,
        .mindar-ui-overlay {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        /* ================= INDICADOR DE MARCADOR ================= */
        #indicador-marcador {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 1000;
            display: none;
            animation: aparecer 0.5s;
        }

        @keyframes aparecer {
            from { opacity: 0; transform: translate(-50%, -20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }

        /* ================= RESPONSIVE ================= */
        @media (max-width: 768px) {
            #logo-carga {
                width: 100px;
                height: 100px;
            }
            
            .texto-carga {
                font-size: 18px;
                padding: 0 20px;
            }
            
            #btn-sonido {
                width: 70px;
                height: 70px;
                font-size: 32px;
            }
        }

        /* ================= PARA IOS (SAFE AREAS) ================= */
        @supports (padding: max(0px)) {
            #btn-sonido {
                bottom: max(20px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <!-- ================= PANTALLA DE CARGA ================= -->
    <div id="pantalla-carga">
        <img id="logo-carga" src="./portada.jpg" alt="Logo AR">
        <div class="texto-carga">Cargando Experiencia de Realidad Aumentada</div>
        <div id="contenedor-progreso">
            <div id="barra-progreso"></div>
        </div>
        <div id="porcentaje">0%</div>
        <button id="btn-iniciar">INICIAR EXPERIENCIA</button>
    </div>

    <!-- ================= ESCENA AR ================= -->
    <div id="contenedor-ar">
        <!-- La escena AR se crearÃ¡ aquÃ­ dinÃ¡micamente -->
    </div>

    <!-- ================= BOTÃ“N DE SONIDO ================= -->
    <button id="btn-sonido">ðŸ”‡</button>

    <!-- ================= INDICADOR DE MARCADOR ================= -->
    <div id="indicador-marcador">
        âœ… Marcador detectado - Video reproduciÃ©ndose
    </div>

    <script>
        // ================= VARIABLES GLOBALES =================
        let videoAR = null;
        let escenaAR = null;
        let marcador = null;
        let sonidoActivo = false;

        // ================= SIMULAR CARGA =================
        function simularCarga() {
            const barra = document.getElementById('barra-progreso');
            const porcentaje = document.getElementById('porcentaje');
            const btnIniciar = document.getElementById('btn-iniciar');
            let progreso = 0;

            const intervalo = setInterval(() => {
                progreso += Math.random() * 10 + 5;
                if (progreso > 100) progreso = 100;
                
                barra.style.width = progreso + '%';
                porcentaje.textContent = Math.round(progreso) + '%';
                
                if (progreso >= 100) {
                    clearInterval(intervalo);
                    // Mostrar botÃ³n para iniciar
                    btnIniciar.style.display = 'block';
                }
            }, 200);
        }

        // ================= INICIAR EXPERIENCIA AR =================
        function iniciarAR() {
            const pantallaCarga = document.getElementById('pantalla-carga');
            const contenedorAR = document.getElementById('contenedor-ar');
            const btnSonido = document.getElementById('btn-sonido');

            // Ocultar pantalla de carga
            pantallaCarga.style.opacity = '0';
            
            setTimeout(() => {
                pantallaCarga.style.display = 'none';
                
                // Crear escena AR dinÃ¡micamente
                contenedorAR.innerHTML = `
                    <a-scene 
                        mindar-image="imageTargetSrc: ./marker.mind; autoStart: true; uiScanning: no; uiLoading: no; uiError: no;" 
                        vr-mode-ui="enabled: false"
                        device-orientation-permission-ui="enabled: false"
                        permission-ui="enabled: false"
                        renderer="colorManagement: true; alpha: true; antialias: true;"
                        embedded
                        loading-screen="enabled: false"
                        keyboard-shortcuts="enterVR: false"
                    >
                        <a-assets>
                            <video 
                                id="video-ar" 
                                src="./asset.mp4" 
                                preload="auto"
                                loop 
                                muted 
                                playsinline 
                                webkit-playsinline
                                crossorigin="anonymous"
                            ></video>
                        </a-assets>
                        
                        <a-camera 
                            position="0 0 0" 
                            look-controls="enabled: false"
                            wasd-controls="enabled: false"
                        ></a-camera>
                        
                        <a-entity 
                            id="marcador" 
                            mindar-image-target="targetIndex: 0"
                        >
                            <a-video
                                src="#video-ar"
                                width="1.78"
                                height="1"
                                position="0 0 0"
                                rotation="0 0 0"
                                material="shader: flat;"
                            ></a-video>
                        </a-entity>
                    </a-scene>
                `;

                // Mostrar contenedor AR
                setTimeout(() => {
                    contenedorAR.style.opacity = '1';
                    
                    // Esperar a que A-Frame cargue completamente
                    setTimeout(() => {
                        configurarEventosAR();
                    }, 1000);
                    
                }, 100);

            }, 500);
        }

        // ================= CONFIGURAR EVENTOS AR =================
        function configurarEventosAR() {
            // Referencias a elementos AR
            marcador = document.querySelector('#marcador');
            videoAR = document.querySelector('#video-ar');
            const btnSonido = document.getElementById('btn-sonido');
            const indicador = document.getElementById('indicador-marcador');

            if (marcador && videoAR) {
                console.log('âœ… Elementos AR listos');

                // Evento: MARCADOR ENCONTRADO
                marcador.addEventListener('targetFound', (event) => {
                    console.log('ðŸŽ¯ Marcador detectado');
                    
                    // Mostrar indicador
                    indicador.style.display = 'block';
                    
                    // Mostrar botÃ³n de sonido
                    btnSonido.style.display = 'flex';
                    
                    // Reproducir video (mute por defecto)
                    videoAR.muted = true;
                    videoAR.play().then(() => {
                        console.log('â–¶ï¸ Video reproduciÃ©ndose');
                    }).catch(err => {
                        console.log('âš ï¸ Error reproduciendo video:', err);
                    });
                });

                // Evento: MARCADOR PERDIDO
                marcador.addEventListener('targetLost', (event) => {
                    console.log('âŒ Marcador perdido');
                    
                    // Ocultar indicador
                    indicador.style.display = 'none';
                    
                    // Pausar video
                    videoAR.pause();
                });

                // Evento: BOTÃ“N DE SONIDO
                btnSonido.addEventListener('click', () => {
                    if (videoAR) {
                        sonidoActivo = !sonidoActivo;
                        videoAR.muted = !sonidoActivo;
                        
                        btnSonido.innerHTML = sonidoActivo ? 'ðŸ”Š' : 'ðŸ”‡';
                        btnSonido.style.background = sonidoActivo ? '#4CAF50' : '#25d366';
                        
                        // Feedback tÃ¡ctil
                        btnSonido.style.transform = 'scale(0.9)';
                        setTimeout(() => {
                            btnSonido.style.transform = 'scale(1)';
                        }, 100);
                        
                        console.log(sonidoActivo ? 'ðŸ”Š Sonido activado' : 'ðŸ”‡ Sonido desactivado');
                    }
                });

                // Limpiar UI de A-Frame periÃ³dicamente
                setInterval(() => {
                    const elementosUI = document.querySelectorAll('.a-enter-vr, .a-enter-ar, .vr-button');
                    elementosUI.forEach(el => {
                        el.style.display = 'none';
                        el.style.opacity = '0';
                    });
                }, 500);

            } else {
                console.error('âŒ No se encontraron elementos AR');
                // Reintentar despuÃ©s de 1 segundo
                setTimeout(configurarEventosAR, 1000);
            }
        }

        // ================= EVENTO DE INICIAR =================
        document.getElementById('btn-iniciar').addEventListener('click', iniciarAR);

        // ================= INICIAR AL CARGAR LA PÃGINA =================
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸš€ Iniciando aplicaciÃ³n AR');
            simularCarga();
            
            // Asegurar que ocupe toda la pantalla
            document.body.style.height = window.innerHeight + 'px';
        });

        // ================= MANEJAR REDIMENSIONAMIENTO =================
        window.addEventListener('resize', () => {
            document.body.style.height = window.innerHeight + 'px';
        });

        // ================= MANEJAR ORIENTACIÃ“N EN MÃ“VILES =================
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                location.reload();
            }, 500);
        });
    </script>
</body>
</html>
